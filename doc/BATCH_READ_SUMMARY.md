# æ‰¹é‡è¯»å–æ¥å£ - å®ç°æ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è¿°

æ–°å¢äº†æ‰¹é‡è¯»å–æ¥å£ `/device/batchRead`ï¼Œå…è®¸åœ¨å•ä¸ª HTTP è¯·æ±‚ä¸­åŒæ—¶è¯»å–å¤šä¸ªä¸åŒé€šé“çš„æ•°æ®ç‚¹ï¼Œæ”¯æŒè‡ªå®šä¹‰å‘½åå’Œè·¨åè®®æ··åˆè¯»å–ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ‰¹é‡è¯»å–
- ä¸€æ¬¡è¯·æ±‚è¯»å–å¤šä¸ªæ•°æ®ç‚¹
- æ¯ä¸ªç‚¹ä½å¯æŒ‡å®šå”¯ä¸€åç§°ï¼ˆnameï¼‰
- æ”¯æŒè·¨é€šé“ï¼ˆä¸åŒè®¾å¤‡ï¼‰è¯»å–
- æ”¯æŒæ··åˆåè®®ï¼ˆModbusã€PJLink ç­‰ï¼‰

### 2. çµæ´»å‚æ•°
- é€šç”¨å‚æ•°ï¼š`name`ï¼ˆæ ‡è¯†ï¼‰ã€`channel_id`ï¼ˆé€šé“IDï¼‰
- åè®®ç‰¹å®šå‚æ•°ï¼šæ ¹æ®ä¸åŒåè®®åŠ¨æ€ä¼ é€’
- Modbus ç¤ºä¾‹ï¼š`addr`ï¼ˆåœ°å€ï¼‰ã€`type`ï¼ˆæ•°æ®ç±»å‹ï¼‰

### 3. å®¹é”™è®¾è®¡
- éƒ¨åˆ†å¤±è´¥ä¸å½±å“å…¶ä»–è¯»å–
- æ¯ä¸ªç»“æœåŒ…å« `success` æ ‡å¿—
- å¤±è´¥é¡¹è¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä»£ç 
- **src/web/server.rs** - æ·»åŠ æ‰¹é‡è¯»å–è·¯ç”±å’Œå¤„ç†å‡½æ•°
  - `BatchReadRequest` - è¯·æ±‚ç»“æ„
  - `BatchReadItem` - å•ä¸ªè¯»å–é¡¹
  - `BatchReadResultItem` - ç»“æœé¡¹
  - `batch_read()` - å¤„ç†å‡½æ•°

### æ–‡æ¡£
1. **BATCH_READ_API.md** (900+ è¡Œ)
   - å®Œæ•´ API æ–‡æ¡£
   - è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹
   - Python/JavaScript/å‰ç«¯ç¤ºä¾‹
   - æ€§èƒ½ä¼˜åŒ–å»ºè®®
   - æ•…éšœæ’æŸ¥æŒ‡å—

2. **BATCH_READ_QUICK_REF.md** (400+ è¡Œ)
   - å¿«é€Ÿå‚è€ƒå¡
   - å¸¸è§æ¨¡å¼
   - ä»£ç æ¨¡æ¿
   - æ€§èƒ½å»ºè®®

3. **config.example.json** - æ›´æ–°
   - æ·»åŠ  batchRead æ¥å£è¯´æ˜
   - æ·»åŠ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ä»£ç 
1. **examples/batch_read_demo.py** (600+ è¡Œ)
   - 7 ä¸ªå®Œæ•´æ¼”ç¤ºåœºæ™¯
   - äº¤äº’å¼èœå•
   - å®æ—¶ç›‘æ§ç¤ºä¾‹
   - é”™è¯¯å¤„ç†æ¼”ç¤º

2. **examples/batch_read_example.js** (500+ è¡Œ)
   - Node.js å®Œæ•´ç¤ºä¾‹
   - 6 ä¸ªæ¼”ç¤ºåœºæ™¯
   - å·¥å…·ç±»å°è£…

3. **test_batch_read.sh** (200+ è¡Œ)
   - Bash è‡ªåŠ¨åŒ–æµ‹è¯•
   - 6 ä¸ªæµ‹è¯•åœºæ™¯
   - å½©è‰²è¾“å‡º

## ğŸ”Œ API æ¥å£

### ç«¯ç‚¹
```
POST http://localhost:8080/device/batchRead
```

### è¯·æ±‚æ ¼å¼
```json
{
  "items": [
    {
      "name": "æ•°æ®ç‚¹åç§°",
      "channel_id": é€šé“ID,
      // ... å…¶ä»–å‚æ•°ï¼ˆæ ¹æ®åè®®ï¼‰
    }
  ]
}
```

### å“åº”æ ¼å¼
```json
{
  "state": 0,
  "message": "æ‰¹é‡è¯»å–å®Œæˆ: æˆåŠŸ 3, å¤±è´¥ 1",
  "data": [
    {
      "name": "æ¸©åº¦",
      "success": true,
      "value": 256
    },
    {
      "name": "é”™è¯¯ç‚¹ä½",
      "success": false,
      "error": "è¿æ¥è¶…æ—¶"
    }
  ]
}
```

## ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯

### 1. å•è®¾å¤‡å¤šç‚¹ç›‘æ§
```json
{
  "items": [
    {"name": "æ¸©åº¦", "channel_id": 3, "addr": 100, "type": "int16"},
    {"name": "å‹åŠ›", "channel_id": 3, "addr": 200, "type": "float32"},
    {"name": "æµé‡", "channel_id": 3, "addr": 300, "type": "uint32"}
  ]
}
```
**ç”¨é€”**: å·¥ä¸šè®¾å¤‡å®Œæ•´çŠ¶æ€ç›‘æ§

### 2. å¤šè®¾å¤‡åŒç±»æ•°æ®
```json
{
  "items": [
    {"name": "1å·æœºæ¸©åº¦", "channel_id": 3, "addr": 100, "type": "int16"},
    {"name": "2å·æœºæ¸©åº¦", "channel_id": 4, "addr": 100, "type": "int16"},
    {"name": "3å·æœºæ¸©åº¦", "channel_id": 5, "addr": 100, "type": "int16"}
  ]
}
```
**ç”¨é€”**: å¤šå°è®¾å¤‡å¯¹æ¯”åˆ†æ

### 3. æ··åˆåè®®æ±‡æ€»
```json
{
  "items": [
    {"name": "ç¯å¢ƒæ¸©åº¦", "channel_id": 3, "addr": 100, "type": "int16"},
    {"name": "æŠ•å½±ä»ªçŠ¶æ€", "channel_id": 1, "command": "get_power"},
    {"name": "ç©ºè°ƒå¼€å…³", "channel_id": 6, "addr": 0, "type": "bool"}
  ]
}
```
**ç”¨é€”**: æ™ºèƒ½æ•™å®¤/ä¼šè®®å®¤ç»Ÿä¸€ç®¡ç†

### 4. å®æ—¶ç›‘æ§é¢æ¿
```python
# æ¯ 2 ç§’åˆ·æ–°ä¸€æ¬¡
while True:
    data = client.batch_read(monitor_items)
    display_dashboard(data)
    time.sleep(2)
```
**ç”¨é€”**: Web ç›‘æ§ç•Œé¢ã€å¤§å±æ˜¾ç¤º

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Python
```python
import requests

response = requests.post("http://localhost:8080/device/batchRead", json={
    "items": [
        {"name": "æ¸©åº¦", "channel_id": 3, "addr": 100, "type": "int16"},
        {"name": "å‹åŠ›", "channel_id": 3, "addr": 200, "type": "float32"}
    ]
})

result = response.json()
for item in result["data"]:
    if item["success"]:
        print(f"{item['name']}: {item['value']}")
```

### JavaScript
```javascript
const response = await fetch('http://localhost:8080/device/batchRead', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    items: [
      {name: 'æ¸©åº¦', channel_id: 3, addr: 100, type: 'int16'},
      {name: 'å‹åŠ›', channel_id: 3, addr: 200, type: 'float32'}
    ]
  })
});

const result = await response.json();
console.log(result);
```

### Bash
```bash
curl -X POST http://localhost:8080/device/batchRead \
  -H "Content-Type: application/json" \
  -d '{
    "items": [
      {"name": "æ¸©åº¦", "channel_id": 3, "addr": 100, "type": "int16"},
      {"name": "å‹åŠ›", "channel_id": 3, "addr": 200, "type": "float32"}
    ]
  }'
```

## ğŸ”§ è¿è¡Œæµ‹è¯•

### 1. å¯åŠ¨æœåŠ¡
```bash
cd dm-rust
cargo run
```

### 2. è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
# Bash è‡ªåŠ¨åŒ–æµ‹è¯•
./test_batch_read.sh

# Python äº¤äº’å¼æ¼”ç¤º
python3 examples/batch_read_demo.py

# JavaScript æ¼”ç¤º
node examples/batch_read_example.js
```

## ğŸ“Š æ€§èƒ½ç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¹¶å‘å¤„ç†** | å¤šä¸ªè¯»å–è¯·æ±‚æŒ‰é¡ºåºæ‰§è¡Œï¼ˆæœªæ¥å¯ä¼˜åŒ–ä¸ºå¹¶å‘ï¼‰ |
| **é”™è¯¯éš”ç¦»** | å•ä¸ªç‚¹ä½å¤±è´¥ä¸å½±å“å…¶ä»–ç‚¹ä½ |
| **çµæ´»å‘½å** | é€šè¿‡ name å­—æ®µæ¸…æ™°æ ‡è¯†æ¯ä¸ªæ•°æ®ç‚¹ |
| **åè®®æ— å…³** | ç»Ÿä¸€æ¥å£æ”¯æŒæ‰€æœ‰åè®® |
| **æ‰©å±•æ€§å¼º** | æ˜“äºæ·»åŠ æ–°å‚æ•°å’Œæ–°åè®® |

## ğŸ¨ ä¸ç°æœ‰æ¥å£å¯¹æ¯”

| æ¥å£ | ç”¨é€” | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `/device/read` | è¯»å–å•ä¸ªèŠ‚ç‚¹ | ç®€å•å•ç‚¹æŸ¥è¯¢ |
| `/device/getAllNodeStates` | è·å–æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ | ç³»ç»Ÿæ•´ä½“çŠ¶æ€æ¦‚è§ˆ |
| `/device/executeCommand` | æ‰§è¡Œå•ä¸ªé€šé“å‘½ä»¤ | å•é€šé“å¤æ‚æ“ä½œ |
| **`/device/batchRead`** | **æ‰¹é‡è¯»å–å¤šç‚¹** | **æ•°æ®é‡‡é›†ã€ç›‘æ§é¢æ¿** |

## ğŸŒŸ ä¼˜åŠ¿æ€»ç»“

âœ… **é«˜æ•ˆ** - ä¸€æ¬¡è¯·æ±‚è·å–å¤šç‚¹æ•°æ®ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”  
âœ… **çµæ´»** - è·¨é€šé“ã€è·¨åè®®ã€è‡ªå®šä¹‰å‘½å  
âœ… **å¥å£®** - éƒ¨åˆ†å¤±è´¥å®¹é”™ï¼Œè¯¦ç»†é”™è¯¯ä¿¡æ¯  
âœ… **æ˜“ç”¨** - ç®€å•çš„ JSON æ ¼å¼ï¼Œå¤šè¯­è¨€ç¤ºä¾‹  
âœ… **é€šç”¨** - é€‚é…æ‰€æœ‰å·²å®ç°çš„åè®®  
âœ… **å¯æ‰©å±•** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ–°åè®®

## ğŸ“– æ–‡æ¡£ç»“æ„

```
dm-rust/
â”œâ”€â”€ BATCH_READ_API.md          # å®Œæ•´ API æ–‡æ¡£ï¼ˆ900+ è¡Œï¼‰
â”œâ”€â”€ BATCH_READ_QUICK_REF.md    # å¿«é€Ÿå‚è€ƒï¼ˆ400+ è¡Œï¼‰
â”œâ”€â”€ config.example.json         # é…ç½®ç¤ºä¾‹ï¼ˆå« API è¯´æ˜ï¼‰
â”œâ”€â”€ test_batch_read.sh         # Bash æµ‹è¯•è„šæœ¬
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ batch_read_demo.py     # Python æ¼”ç¤ºï¼ˆ600+ è¡Œï¼‰
â”‚   â””â”€â”€ batch_read_example.js  # JavaScript æ¼”ç¤ºï¼ˆ500+ è¡Œï¼‰
â””â”€â”€ src/web/
    â””â”€â”€ server.rs              # æ ¸å¿ƒå®ç°
```

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **å¹¶å‘è¯»å–** - å¤šä¸ªç‚¹ä½å¹¶å‘æ‰§è¡Œï¼Œæå‡æ€§èƒ½
2. **ç¼“å­˜æœºåˆ¶** - å¯¹é«˜é¢‘è¯»å–æ•°æ®æä¾›ç¼“å­˜é€‰é¡¹
3. **WebSocket æ¨é€** - å®æ—¶æ•°æ®å˜åŒ–ä¸»åŠ¨æ¨é€
4. **æ•°æ®èšåˆ** - æ”¯æŒæ±‚å¹³å‡å€¼ã€æœ€å¤§å€¼ç­‰ç»Ÿè®¡
5. **æ‰¹é‡å†™å…¥** - ç±»ä¼¼æ¥å£æ”¯æŒæ‰¹é‡å†™å…¥æ“ä½œ

## ğŸ“ å¼€å‘æ—¥å¿—

- **2025-11-11**: åˆå§‹å®ç°
  - æ·»åŠ  `/device/batchRead` ç«¯ç‚¹
  - å®ç°è¯·æ±‚/å“åº”ç»“æ„
  - åˆ›å»ºå®Œæ•´æ–‡æ¡£å’Œç¤ºä¾‹
  - ç¼–è¯‘æµ‹è¯•é€šè¿‡

## âœ… ç¼–è¯‘çŠ¶æ€

```bash
$ cargo build --release
   Finished `release` profile [optimized] target(s) in 3.02s
```

æ‰€æœ‰åŠŸèƒ½ç¼–è¯‘é€šè¿‡ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼

## ğŸ¯ æ€»ç»“

æ‰¹é‡è¯»å–æ¥å£ä¸ºå·¥ä¸šæ•°æ®é‡‡é›†ç³»ç»Ÿæä¾›äº†é«˜æ•ˆã€çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ç»Ÿä¸€çš„æ¥å£æ ¼å¼ï¼Œå¯ä»¥è½»æ¾å®ç°ï¼š

- å®æ—¶ç›‘æ§é¢æ¿
- æ•°æ®è®°å½•ç³»ç»Ÿ
- å¤šè®¾å¤‡ååŒ
- è·¨åè®®æ•°æ®æ±‡æ€»

é…åˆè¯¦ç»†çš„æ–‡æ¡£å’Œå¤šè¯­è¨€ç¤ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿé›†æˆåˆ°å„ç§åº”ç”¨åœºæ™¯ä¸­ã€‚
