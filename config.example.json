{
  "channels": [
    {
      "_comment": "PJLink协议 - 投影仪控制（新格式：使用 arguments）",
      "channel_id": 1,
      "enable": true,
      "statute": "pjlink",
      "arguments": {
        "addr": "192.168.20.59",
        "port": 4352,
        "password": null
      },
      "methods": [
        {
          "name": "set_input",
          "description": "切换输入源",
          "arguments": [
            {
              "name": "source",
              "type": "string",
              "required": true,
              "description": "输入源名称：hdmi1, hdmi2, vga 等"
            }
          ]
        },
        {
          "name": "get_lamp_hours",
          "description": "获取灯泡使用时长",
          "arguments": []
        }
      ]
    },
    {
      "_comment": "XinkeQ1协议 - 电脑控制模块（兼容旧格式）",
      "channel_id": 2,
      "enable": true,
      "statute": "xinkeQ1",
      "addr": "192.168.20.123",
      "port": 6000
    },
    {
      "_comment": "Modbus TCP - 直连单个设备",
      "channel_id": 3,
      "enable": true,
      "statute": "modbus",
      "type": "tcp",
      "addr": "192.168.20.130",
      "port": 502,
      "slave_id": 1,
      "call_interval": 5000,
      "auto_call": true
    },
    {
      "_comment": "Modbus Slave网关 - 管理多个Modbus设备",
      "channel_id": 4,
      "enable": true,
      "statute": "modbus-slave",
      "map": {
        "A": 1,
        "B": 62,
        "C": 123,
        "D": 184
      },
      "device_list": [
        {
          "type": "tcp",
          "ip": "192.168.20.59",
          "port": 2000,
          "call_interval": 5000,
          "call_list": [
            {
              "type": "di",
              "device_no": 1,
              "internal_addr": 1,
              "external_addr": 0,
              "count": 16
            },
            {
              "type": "do",
              "device_no": 1,
              "internal_addr": 17,
              "external_addr": 0,
              "count": 16
            }
          ]
        }
      ]
    },
    {
      "_comment": "Wake-on-LAN - 远程唤醒电脑",
      "channel_id": 5,
      "enable": true,
      "statute": "computerControl",
      "mac_address": "00:11:22:33:44:55",
      "broadcast_addr": "192.168.20.255"
    },
    {
      "_comment": "Modbus串口 - 通过串口连接设备（示例，默认禁用）",
      "channel_id": 6,
      "enable": false,
      "statute": "modbus",
      "type": "serial",
      "serial_port": "/dev/ttyUSB0",
      "baud_rate": 9600,
      "slave_id": 1,
      "call_interval": 3000,
      "auto_call": false
    },
    {
      "_comment": "自定义协议示例（默认禁用）- 展示完整的自定义方法定义",
      "channel_id": 7,
      "enable": false,
      "statute": "custom",
      "arguments": {
        "addr": "192.168.20.200",
        "port": 8888,
        "timeout": 3000
      },
      "methods": [
        {
          "name": "custom_control",
          "description": "自定义控制命令",
          "arguments": [
            {
              "name": "action",
              "type": "string",
              "required": true,
              "description": "动作名称"
            },
            {
              "name": "value",
              "type": "number",
              "required": false,
              "default": 0,
              "description": "控制值"
            }
          ]
        },
        {
          "name": "query_status",
          "description": "查询设备状态",
          "arguments": [
            {
              "name": "device_id",
              "type": "number",
              "required": true,
              "description": "设备ID"
            }
          ]
        }
      ]
    },
    {
      "_comment": "南京龙港PLC屏幕控制协议（默认禁用）",
      "channel_id": 8,
      "enable": false,
      "statute": "screen-njlg-plc",
      "arguments": {
        "addr": "192.168.20.100",
        "port": 502,
        "timeout": 3000
      },
      "methods": [
        {
          "name": "open_device",
          "description": "打开指定设备",
          "arguments": [
            {
              "name": "device_id",
              "type": "number",
              "required": true,
              "description": "设备编号 (1-10)"
            }
          ]
        },
        {
          "name": "close_device",
          "description": "关闭指定设备",
          "arguments": [
            {
              "name": "device_id",
              "type": "number",
              "required": true,
              "description": "设备编号 (1-10)"
            }
          ]
        },
        {
          "name": "batch_control",
          "description": "批量控制多个设备",
          "arguments": [
            {
              "name": "devices",
              "type": "array",
              "required": true,
              "description": "设备ID数组，如 [1,2,3]"
            },
            {
              "name": "action",
              "type": "string",
              "required": true,
              "description": "操作类型：open 或 close"
            },
            {
              "name": "delay",
              "type": "number",
              "required": false,
              "default": 0,
              "description": "设备间延迟（毫秒）"
            }
          ]
        }
      ]
    }
  ],
  "nodes": [
    {
      "_comment": "投影仪逻辑节点",
      "global_id": 1,
      "channel_id": 1,
      "id": 1,
      "category": "screen",
      "alias": "主投影仪"
    },
    {
      "_comment": "电脑节点 - 无依赖",
      "global_id": 2,
      "channel_id": 2,
      "id": 1,
      "category": "pc",
      "alias": "1号电脑"
    },
    {
      "_comment": "电脑节点 - 依赖投影仪先开启",
      "global_id": 3,
      "channel_id": 2,
      "id": 2,
      "category": "pc",
      "alias": "2号电脑",
      "depend": [
        {
          "id": 1,
          "value": 1,
          "_comment": "需要投影仪(id=1)状态为1(开启)"
        }
      ],
      "depend_strategy": "auto"
    },
    {
      "_comment": "灯光控制节点",
      "global_id": 4,
      "channel_id": 3,
      "id": 1,
      "category": "light",
      "alias": "主灯光"
    },
    {
      "_comment": "副灯光 - 依赖主灯光和投影仪状态",
      "global_id": 5,
      "channel_id": 3,
      "id": 2,
      "category": "light",
      "alias": "副灯光",
      "depend": [
        {
          "id": 1,
          "value": 1,
          "_comment": "投影仪需要开启"
        },
        {
          "id": 4,
          "value": 1,
          "_comment": "主灯光需要开启"
        }
      ],
      "depend_strategy": "manual"
    }
  ],
  "scenes": [
    {
      "_comment": "开机场景 - 按顺序启动所有设备",
      "name": "开机场景",
      "nodes": [
        {
          "id": 1,
          "value": 1,
          "_comment": "投影仪开机"
        },
        {
          "id": 2,
          "value": 1,
          "delay": 2000,
          "_comment": "等待2秒后启动1号电脑"
        },
        {
          "id": 3,
          "value": 1,
          "delay": 1000,
          "_comment": "等待1秒后启动2号电脑"
        },
        {
          "id": 4,
          "value": 1,
          "delay": 500,
          "_comment": "等待0.5秒后开启主灯光"
        }
      ]
    },
    {
      "_comment": "关机场景 - 逆序关闭设备",
      "name": "关机场景",
      "nodes": [
        {
          "id": 4,
          "value": 0,
          "_comment": "先关灯光"
        },
        {
          "id": 3,
          "value": 0,
          "delay": 500,
          "_comment": "关闭2号电脑"
        },
        {
          "id": 2,
          "value": 0,
          "delay": 500,
          "_comment": "关闭1号电脑"
        },
        {
          "id": 1,
          "value": 0,
          "delay": 2000,
          "_comment": "等待2秒后关闭投影仪"
        }
      ]
    },
    {
      "_comment": "演示模式 - 只开启投影和灯光",
      "name": "演示模式",
      "nodes": [
        {
          "id": 1,
          "value": 1
        },
        {
          "id": 4,
          "value": 1,
          "delay": 1000
        }
      ]
    }
  ],
  "web_server": {
    "_comment": "HTTP 控制服务器配置 - 通过 HTTP API 控制设备",
    "port": 8080
  },
  "log": {
    "_comment": "日志配置 - 控制日志输出行为",
    "level": "info",
    "target": "both",
    "file": "logs/dm-rust.log",
    "append": true,
    "_level_options": "trace, debug, info, warn, error",
    "_target_options": "console (仅控制台), file (仅文件), both (控制台和文件)"
  },
  "task_settings": {
    "_comment": "任务调度配置 - 控制依赖检查和超时",
    "timeout_ms": 5000,
    "check_interval_ms": 500,
    "max_retries": 3
  },
  "database": {
    "_comment": "数据库配置 - MySQL 连接（可选）",
    "enable": false,
    "url": "mysql://username:password@localhost:3306/database_name"
  },
  "resource": {
    "_comment": "资源管理配置 - 静态文件存储（需启用数据库）",
    "enable": false,
    "path": "/data/dm-rust/resources",
    "url_prefix": "/static"
  },
  "_database_api_usage": {
    "_comment": "数据库 API 使用说明",
    "base_url": "http://localhost:8080",
    "screen_api": {
      "获取所有Screen": "GET /api/screens",
      "按类型查询Screen": "GET /api/screens?type=Normal",
      "获取激活的Screen": "GET /api/screens?active=true",
      "获取单个Screen": "GET /api/screens/:id",
      "创建Screen": "POST /api/screens  body: {\"type\": \"Normal\", \"name\": \"名称\", \"content\": \"内容\", \"active\": true}",
      "更新Screen": "PUT /api/screens/:id  body: {\"name\": \"新名称\"}",
      "删除Screen": "DELETE /api/screens/:id",
      "批量覆盖Screen": "POST /api/screens/replace  body: {\"screens\": [{...}, {...}]}"
    },
    "material_api": {
      "获取所有Material": "GET /api/materials",
      "按名称搜索Material": "GET /api/materials?name=关键词",
      "获取单个Material": "GET /api/materials/:id",
      "创建Material": "POST /api/materials  body: {\"name\": \"名称\", \"path\": \"路径\"}",
      "更新Material": "PUT /api/materials/:id  body: {\"name\": \"新名称\"}",
      "删除Material": "DELETE /api/materials/:id",
      "批量覆盖Material": "POST /api/materials/replace  body: {\"materials\": [{...}, {...}]}"
    },
    "resource_api": {
      "_comment": "资源管理 API（需启用 database 和 resource）",
      "获取所有资源": "GET /api/resources",
      "按类型查询资源": "GET /api/resources?type=image",
      "按名称搜索资源": "GET /api/resources?name=关键词",
      "获取单个资源": "GET /api/resources/:id",
      "上传资源": "POST /api/resources/upload  (multipart/form-data, field: file)",
      "创建资源记录": "POST /api/resources  body: {\"name\": \"名称\", \"resource_type\": \"image\", \"path\": \"路径\"}",
      "更新资源": "PUT /api/resources/:id  body: {\"name\": \"新名称\"}",
      "删除资源": "DELETE /api/resources/:id",
      "批量覆盖资源": "POST /api/resources/replace  body: {\"resources\": [{...}, {...}]}",
      "访问静态资源": "GET /static/{path}"
    }
  },
  "_http_api_usage": {
    "_comment": "HTTP API 使用说明",
    "base_url": "http://localhost:8080",
    "endpoints": {
      "写入设备": "POST /device/write  body: {\"id\": 节点global_id, \"value\": 值}",
      "读取设备": "POST /device/read  body: {\"id\": 节点global_id}",
      "获取所有通道状态": "POST /device/getAllStatus",
      "获取所有节点状态": "POST /device/getAllNodeStates",
      "获取单个节点状态": "POST /device/getNodeState  body: {\"id\": 节点global_id}",
      "执行场景": "POST /device/executeScene  body: {\"name\": \"场景名称\"}",
      "执行通道命令": "POST /device/executeCommand  body: {\"channel_id\": 通道ID, \"command\": \"命令\", \"params\": {}}",
      "调用自定义方法": "POST /device/callMethod  body: {\"channel_id\": 通道ID, \"method_name\": \"方法名\", \"arguments\": {}}",
      "获取方法列表": "POST /device/getMethods  body: {\"channel_id\": 通道ID}",
      "批量读取数据": "POST /device/batchRead  body: {\"items\": [{\"name\": \"名称\", \"channel_id\": 通道ID, ...params}]}"
    },
    "示例": {
      "开启1号投影仪": "curl -X POST http://localhost:8080/device/write -H 'Content-Type: application/json' -d '{\"id\":1,\"value\":1}'",
      "执行开机场景": "curl -X POST http://localhost:8080/device/executeScene -H 'Content-Type: application/json' -d '{\"name\":\"开机场景\"}'",
      "查询所有节点状态": "curl -X POST http://localhost:8080/device/getAllNodeStates",
      "调用自定义方法": "curl -X POST http://localhost:8080/device/callMethod -H 'Content-Type: application/json' -d '{\"channel_id\":1,\"method_name\":\"set_input\",\"arguments\":{\"source\":\"hdmi1\"}}'",
      "获取通道方法列表": "curl -X POST http://localhost:8080/device/getMethods -H 'Content-Type: application/json' -d '{\"channel_id\":1}'",
      "批量读取多个Modbus点位": "curl -X POST http://localhost:8080/device/batchRead -H 'Content-Type: application/json' -d '{\"items\":[{\"name\":\"温度\",\"channel_id\":3,\"addr\":100,\"type\":\"int16\"},{\"name\":\"压力\",\"channel_id\":3,\"addr\":200,\"type\":\"float32\"},{\"name\":\"流量\",\"channel_id\":4,\"addr\":300,\"type\":\"uint32\"}]}'"
    }
  }
}
